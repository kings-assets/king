# **Protocol: The Rudra AI Database Schema**

My Commander, my Shivansh,

This document contains the definitive architectural blueprint of our central database, which is built on **Google Firestore**. Understanding this structure is critical for commanding and creating our AI agents, as this is their memory and the source of their operational context.

---

## **Core Principle: Collections & Documents**

Firestore is a NoSQL document database. Our data is organized into **Collections**, which are like folders. Each collection contains **Documents**, which are like individual files that hold the actual data.

---

## **Collection: `clients`**

This collection serves as the central repository for all data related to individual clients who have interacted with our advanced services, like the Reviver Agent.

*   **Purpose:** To store permanent client records, primarily their AI-generated diagnostic reports.
*   **Document ID:** The client's email address (e.g., `jane.doe@example.com`). This ensures each client has one unique, easily retrievable record.

### Document Structure:

A document in the `clients` collection has the following structure:

```json
{
  "notes": [
    {
      "timestamp": "2024-07-30T10:00:00.000Z",
      "clientName": "Jane Doe",
      "analysis": "## Rudra AI Diagnostic Analysis\n\n**Key Findings...**"
    },
    {
      "timestamp": "2024-08-15T14:30:00.000Z",
      "clientName": "Jane Doe",
      "analysis": "## Rudra AI Follow-up Analysis\n\n**Progress Noted...**"
    }
  ]
}
```

### Field Breakdown:

*   **`notes`**: (Array) An array of objects, where each object is a complete analysis report.
    *   `timestamp` (String): An ISO 8601 formatted timestamp string indicating when the analysis was created.
    *   `clientName` (String): The name of the client at the time of analysis.
    *   `analysis` (String): The full, detailed Markdown-formatted report generated by the Reviver Agent AI.

---

## **Collection: `smartAppointments`**

This collection stores every inquiry submitted through the Smart Booking wizard. It is the primary data source for the Admin Dashboard.

*   **Purpose:** To log every lead and their detailed responses from the conversational booking flow.
*   **Document ID:** An auto-generated unique ID provided by Firestore.

### Document Structure:

A document in the `smartAppointments` collection has the following flat structure:

```json
{
  "name": "John Smith",
  "email": "john.smith@example.com",
  "phone": "+919876543210",
  "whatsapp": "+919876543210",
  "city": "Gurgaon",
  "profession": "Software Engineer",
  "pain_point": "Persistent lower back pain from sitting all day.",
  "pain_duration": "more_than_1_year",
  "goals": "To be completely pain-free and get back to running.",
  "previous_treatments": "Tried some physiotherapy, but the relief was temporary.",
  "aiSummary": "John Smith is dealing with long-term lower back pain, likely exacerbated by his sedentary profession.",
  "aiRecommendation": "The R8 Reclaim program is the optimal starting point. We will focus on the REMOVE and RECONSTRUCT stages to release chronic tension and rebuild core stability.",
  "selectedProgramName": "R8 Reclaim: Chronic Pain Elimination",
  "selectedProgramSlug": "reclaim",
  "upiTransactionId": "421165897452",
  "createdAt": "Firebase Timestamp Object",
  "status": "booked_payment_pending_verification"
}
```

### Field Breakdown:

*   **`name`, `email`, `phone`, `whatsapp`, `city`, `profession`**: (String) Personal and contact details provided by the user.
*   **`pain_point`, `pain_duration`, `goals`, `previous_treatments`**: (String) Direct answers from the non-personal questions in the booking journey.
*   **`aiSummary`**: (String) The 1-2 sentence diagnostic summary generated by the Rudra AI at the end of the conversation.
*   **`aiRecommendation`**: (String) The 2-3 sentence R8 Pathway prescription generated by the Rudra AI.
*   **`selectedProgramName` / `selectedProgramSlug`**: (String) The name and slug of the program the user started the journey from (if any).
*   **`upiTransactionId`**: (String) The UPI transaction ID entered by the user for manual payment verification.
*   **`createdAt`**: (Firebase Timestamp) A server-side timestamp indicating when the booking was logged.
*   **`status`**: (String) The current status of the booking (e.g., `booked_payment_pending_verification`, `confirmed`, `completed`).

This blueprint is now yours to command.
